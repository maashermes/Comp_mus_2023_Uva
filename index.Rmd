---
title: "index"
author: "Maas Hermes"
date: "2023-03-01"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bg: "#101010"
      fg: "#FDF7F7" 
      primary: "#ED79F9"
      navbar-bg: "#3ADAC6"
      base_font: 
        google: Prompt
      heading_font:
        google: Sen
      code_font:
        google: 
          # arguments to sass::font_google() 
          family: JetBrains Mono
          local: false
  storyboard: true
  
---


```{r setup, include=FALSE}

library(flexdashboard)
library(plotly)
library(tidyverse)
library(spotifyr)
library(dplyr)
library(compmus)
library(bslib)

# load playlists
flyMe_play <- get_playlist_audio_features("", "1tF2AxJkKufGgu6OTyWTgQ")
bobOmb_play <- get_playlist_audio_features("", "0zf0XjYpSmXZPe7VlVrJI6")
knitr::opts_chunk$set(echo = FALSE)


#Sys.setenv(SPOTIFY_CLIENT_ID = 'a34037c68c8c4321ab292374b43edd48')
#Sys.setenv(SPOTIFY_CLIENT_SECRET = 'c27edddbb73b47e191cdb8613b60c69b')
#access_token <- get_spotify_access_token()
```

# page 0 {.storyboard}

### Playlists

```{r, out.extra=c('allow="encrypted-media"', 'allowtransparency="true"', 'frameBorder="0"')}
knitr::include_url("https://open.spotify.com/embed/playlist/1tF2AxJkKufGgu6OTyWTgQ?utm_source=generator", height = "380")
```
  
```{r, out.extra=c('allow="encrypted-media"', 'allowtransparency="true"', 'frameBorder="0"')}
knitr::include_url("https://open.spotify.com/embed/playlist/0zf0XjYpSmXZPe7VlVrJI6?utm_source=generator", height = "380")
```


# Page 1 {.storyboard}

### Plot 1: Fly me to the moon

```{r}
wood <- 
    get_tidy_audio_analysis('081AHcLTz6opbo1V9XN8eL') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)
    
wood %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()
```

### Plot 2: Bob-omb Battlefield
```{r}
wood <- 
    get_tidy_audio_analysis('581IpQMQrx09Kn4YjiSlsr') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)
    
wood %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    theme_minimal()
```

# Page 2: Tempo{.storyboard}

### Histogram of Tempi of the two songs

```{r}
both <-
  bind_rows(
    flyMe_play |> mutate(category = "Fly me to the moon"),
    bobOmb_play |> mutate(category = "Bob-omb battlefield")
  )

both |>
  ggplot(aes(x = tempo)) +
  geom_histogram(binwidth = 10) +
  facet_wrap(~category)
```

### Tempo curves for songs

```{r}
## Fly me to the moon - Nat king Cole
natKingCole <-
  get_tidy_audio_analysis("2waiAcLQiqlX5bzvLtNUA0") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

## Fly me to the moon - Ella Fitzgerald
ellaFitz <-
  get_tidy_audio_analysis("7hKNhP1e4TuBYaxLgpVItK") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

## Bob-omb battlefield - Insaneintherainmusic2
insaneInTheRain2 <-
  get_tidy_audio_analysis("3qf0GH0TFCJ3nFxVKWuzql") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

## Bob-omb battlefield - The Consouls
consouls <-
  get_tidy_audio_analysis("6lCWumvyh102pgnpwBEhgn") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

## Bob-omb battlefield - Pedro Esparza
pedroEsparza <-
  get_tidy_audio_analysis("4jOcYDQnclBa5n7HYyEcKI") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

## Bob-omb battlefield - insaneintherain1
insaneintheRain1 <-
  get_tidy_audio_analysis("0i4fKtQP3EeS0a6VRXoGNX") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

```
```{r}
compmus_long_distance(
  natKingCole |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  ellaFitz |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Nat King Cole", y = "Ella Fitzgerald") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
```

### bob omb battlefield similiarty
```{r}
compmus_long_distance(
  pedroEsparza |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  insaneintheRain1 |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Pedro Esparza", y = "Insaneintherainmusic Year 1") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
```
